# Переменные окружения для NetworkScannerService

Ниже перечислены переменные, которые влияют на работу сетевого сканера, их значения по умолчанию и назначение.

| Переменная | По умолчанию | Назначение |
| --- | --- | --- |
| `NETWORK_SCANNER_TIMEOUT_MS` | `5000` | Таймаут HTTP-запроса к агенту в миллисекундах. |
| `NETWORK_SCANNER_CONCURRENCY` | `25` | Количество одновременных проверок IP-адресов при сканировании. |
| `NETWORK_SCANNER_BACKOFF_ENABLED` | `false` | Включает экспоненциальный backoff при повторных попытках обращения к агенту. |
| `NETWORK_SCANNER_BACKOFF_BASE_MS` | `200` | Базовая задержка (в мс) между повторными попытками при включенном backoff. |
| `NETWORK_SCANNER_MAX_RETRIES` | `3` | Максимальное количество повторных попыток обращения к агенту при ошибке. |
| `NETWORK_SCANNER_CACHE_TTL_SECONDS` | `600` | Время жизни кэша `agentKey→ipAddress` (в секундах) как для in-memory, так и для Redis. |
| `AGENT_PORT` | `9182` | Порт HTTP-интерфейса агента, который опрашивается сканером. |
| `AGENT_HANDSHAKE_KEY` | `VERY_SECRET_KEY` | Секретный ключ рукопожатия, отправляется в заголовке `X-Agent-Handshake-Key` при запросе `/metrics`. Задайте собственное значение в production. |
| `NEXT_PUBLIC_SERVER_IP` | — | (Production) Статический IP сервера. Если указан, подсеть рассчитывается как `x.y.z.0/24` на основе этого адреса. |
| `REDIS_URL` | — | Полный URL Redis. Приоритетнее, чем `REDIS_HOST/REDIS_PORT/REDIS_PASSWORD`. Используется для очереди задач сканирования и для кэширования IP при наличии клиента. |
| `REDIS_HOST` | `localhost` | Хост Redis, если `REDIS_URL` не задан. |
| `REDIS_PORT` | `6379` | Порт Redis, если `REDIS_URL` не задан. |
| `REDIS_PASSWORD` | — | Пароль Redis, если требуется и не используется `REDIS_URL`. |

> Примечание: переменные Redis используются очередью `network-scan.queue` и вспомогательным Redis-клиентом, а отсутствие клиента автоматически переводит кэш в режим только in-memory.
