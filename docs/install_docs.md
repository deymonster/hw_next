# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é HW Monitor

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **HW Monitor**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –¥–≤–∞ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç) –∏ —Ä—É—á–Ω–æ–π (—á–µ—Ä–µ–∑ Docker Compose).

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –û–°

- **Ubuntu 20.04+ / Debian 11+**
- **Astra Linux Special Edition 1.7+** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤)
- –î—Ä—É–≥–∏–µ Linux –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Docker

---

## üöÄ –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `install_v2.sh`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è, —É—Å—Ç–∞–Ω–æ–≤–∫—É Docker, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–∞—Ä–æ–ª–µ–π –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤.

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ `sudo`):

```bash
chmod +x install_v2.sh
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:

1.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –û–°**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç Astra Linux –∏–ª–∏ Debian/Ubuntu.
2.  **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker**:
    - –ù–∞ **Astra Linux**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç `/etc/apt/sources.list.d/astra.list`, –æ—Ç–∫–ª—é—á–∞–µ—Ç CD-ROM —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `docker.io` –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Debian Bullseye.
    - –ù–∞ **Ubuntu/Debian**: –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Docker.
3.  **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫**: –°–æ–∑–¥–∞–µ—Ç —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/opt/hw-monitor`).
4.  **–§–∞–π–ª—ã**: –°–∫–∞—á–∏–≤–∞–µ—Ç `docker-compose.prod.yml` –∏ —É—Ç–∏–ª–∏—Ç—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `hwctl`.
5.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
    - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `.env.prod` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–∞—Ä–æ–ª—è–º–∏ –ë–î.
    - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP, Telegram –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ).
6.  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `nginx/auth/.htpasswd` –¥–ª—è –∑–∞—â–∏—Ç—ã –º–µ—Ç—Ä–∏–∫ Prometheus.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)

–°–∫—Ä–∏–ø—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (non-interactive):

```bash
sudo bash install_v2.sh \
  --non-interactive \
  --install-dir "/opt/monitor" \
  --admin-email "admin@company.com" \
  --basic-auth-user "admin" \
  --basic-auth-pass "secure_pass"
```

### –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º (–ó–µ—Ä–∫–∞–ª–∞ Docker)

–ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ (–æ—à–∏–±–∫–∏ `EOF`, `timeout`), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–µ—Ä–∫–∞–ª–∞ –¥–ª—è Docker (–∞–∫—Ç—É–∞–ª—å–Ω–æ –¥–ª—è –†–§).

1.  –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/docker/daemon.json`:
    ```bash
    sudo mkdir -p /etc/docker
    sudo tee /etc/docker/daemon.json <<EOF
    {
      "registry-mirrors": [
        "https://dockerhub.timeweb.cloud",
        "https://huecker.io",
        "https://mirror.gcr.io"
      ]
    }
    EOF
    ```
2.  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É Docker:
    ```bash
    sudo systemctl daemon-reload
    sudo systemctl restart docker
    ```
3.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–Ω–æ–≤–æ.

---

## üõ† –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏.

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è Docker volumes:

```bash
mkdir -p /opt/hw-monitor
cd /opt/hw-monitor
mkdir -p storage/logs
mkdir -p storage/uploads
mkdir -p nginx/auth
mkdir -p data
```

### 2. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã

–í –ø–∞–ø–∫—É `/opt/hw-monitor` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –¥–≤–∞ —Ñ–∞–π–ª–∞:

1.  `docker-compose.prod.yml` (–∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è).
2.  `.env.prod` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è –∫–æ–ø–∏—è `.env.example`).

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.prod`, –∑–∞–ø–æ–ª–Ω–∏–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

- `POSTGRES_PASSWORD`, `REDIS_PASSWORD` (–ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏).
- `NEXTAUTH_SECRET`, `ENCRYPTION_KEY` (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ `openssl rand -hex 32`).
- `SMTP_*` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã).
    > **–í–∞–∂–Ω–æ:** –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–æ—á—Ç–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Yandex, Gmail, Mail.ru) –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **"–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –ø–æ—á—Ç–æ–≤–æ–≥–æ —è—â–∏–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ø–æ–ª–µ `SMTP_PASSWORD`.

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Basic Auth (–í–∞–∂–Ω–æ!)

Nginx —Ç—Ä–µ–±—É–µ—Ç —Ñ–∞–π–ª –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–ª—É–∂–µ–±–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ —Å–æ–∑–¥–∞—Ç—å, Nginx –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ 'admin' –∏ 'password' –Ω–∞ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
echo "admin:$(openssl passwd -apr1 password)" > nginx/auth/.htpasswd
```

_–ï—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞, —Å–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª: `touch nginx/auth/.htpasswd`_

### 5. –ó–∞–ø—É—Å–∫

```bash
docker compose -f docker-compose.prod.yml up -d
```

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/opt/hw-monitor`)

- `docker-compose.prod.yml` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤.
- `.env.prod` ‚Äî —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- `hwctl.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
- `data/` ‚Äî –¥–∞–Ω–Ω—ã–µ PostgreSQL –∏ LICD (Licensing).
- `storage/` ‚Äî –ª–æ–≥–∏ –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.
- `nginx/auth/.htpasswd` ‚Äî —Ñ–∞–π–ª –ø–∞—Ä–æ–ª–µ–π.

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Astra Linux

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã Docker:

1.  –í `/etc/apt/sources.list` –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Å `cdrom:`.
2.  –°–æ–∑–¥–∞–µ—Ç—Å—è `/etc/apt/sources.list.d/astra.list` —Å –∑–µ—Ä–∫–∞–ª–∞–º–∏ `dl.astralinux.ru`.
3.  –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–∞ `docker.io` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `debian bullseye`.

---

## üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (hwctl)

–ü—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ `hwctl` (—Å–∏–º–ª–∏–Ω–∫ `/usr/local/bin/hwctl` -> `/opt/hw-monitor/hwctl.sh`).

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã**:

    ```bash
    sudo hwctl update
    ```

    _–°–∫–∞—á–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã (pull), –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã._

- **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤**:

    ```bash
    sudo hwctl logs
    ```

- **–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤**:

    ```bash
    sudo hwctl ps
    ```

- **–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**:
    ```bash
    sudo hwctl purge --remove-images
    ```
    _–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã, —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Ç–æ–º–∞ (volumes) –∏ –æ–±—Ä–∞–∑—ã._
